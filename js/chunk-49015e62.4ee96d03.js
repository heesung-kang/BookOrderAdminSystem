(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-49015e62"],{"0a80":function(t,s,o){"use strict";o("f630")},4809:function(t,s,o){},"65da":function(t,s,o){"use strict";o("f237")},"68e0":function(t,s,o){"use strict";o.d(s,"a",(function(){return a}));const a=function(t,s,o,a){return{name:t,width:s,height:o,resizable:a,clickToClose:!0,draggable:".popup-title",scrollable:!0}}},"6f4c":function(t,s,o){"use strict";o.r(s);o("14d9");var a=o("2f62"),e=o("e31c"),i=o("e71f"),n=o("f3e4"),c=o("78c6"),r=o("490a"),d={name:"Order",components:{modalWrap:o("7402").a},props:["id","origin"],data:()=>({memo:"",booksList:[],sid:""}),computed:{...Object(a.b)("common",["loading"])},async created(){const t=Object(n.b)("userInfo");this.sid=t.info.sid},async mounted(){this.$store.commit("common/setLoading",!0),this.booksList=[];const t=Object(i.m)(Object(i.b)(e.b,"booksData"),Object(i.r)("sid","==",this.sid));(await Object(i.h)(t)).forEach(t=>{this.booksList.push({id:this.id,data:t.data(),rate:""})});const s=[];this.origin.forEach(t=>{t.uid===this.id&&t.data.bookRate.forEach(t=>{s.push(t.data)})}),this.booksList.forEach(t=>{s.forEach(s=>{s.isbn===t.data.isbn&&(t.rate=s.rate)})}),this.$store.commit("common/setLoading",!1)},methods:{close(){this.$emit("close")},async booksRateSave(t){this.origin.forEach(s=>{s.uid===t&&(this.oldRate=s.data.bookRate)});const s=[];this.booksList.forEach(o=>{s.push({uid:t,data:{isbn:o.data.isbn,rate:o.rate}})});const o=this.oldRate.filter(t=>{s.forEach(s=>{if(t.data.isbn!==s.data.isbn)return t})}),a=s.concat(o);this.$store.commit("common/setLoading",!0);try{await Object(i.q)(Object(i.d)(e.b,"shopInfo",t),{bookRate:a}),this.$store.commit("common/setLoading",!1),this.$attrs.update(),this.close()}catch(t){console.log(t),this.$store.commit("common/setLoading",!1)}}}},l=(o("0a80"),o("2877")),h=Object(l.a)(d,(function(){var t=this,s=t._self._c;return s("modalWrap",{on:{close:t.close}},[s("template",{slot:"head"},[s("h2",[t._v("서적별 공급률 설정")])]),s("template",{slot:"body"},[s("div",{staticClass:"v-application"},[t.loading?s(r.a,{staticClass:"spinner",attrs:{size:70,width:7,color:"amber",indeterminate:""}}):t._e()],1),s("div",{staticClass:"overflow"},[s("ul",t._l(t.booksList,(function(o){return s("li",{key:o.data.isbn,staticClass:"d-flex book-list"},[s("div",{staticClass:"wrap"},[s("span",{staticClass:"mr10 isbn"},[t._v(t._s(o.data.isbn))]),s("span",{staticClass:"mr10 subject"},[t._v(t._s(o.data.subject))]),s("span",{staticClass:"init"},[s("input",{directives:[{name:"model",rawName:"v-model",value:o.rate,expression:"book.rate"}],attrs:{type:"number"},domProps:{value:o.rate},on:{input:function(s){s.target.composing||t.$set(o,"rate",s.target.value)}}})])])])})),0)]),s("div",{staticClass:"btn-save"},[s("button",{staticClass:"primary",on:{click:function(s){return t.booksRateSave(t.id)}}},[t._v("서적별 공급률 저장")])])])],2)}),[],!1,null,"a37fe750",null).exports,u=o("68e0"),m={name:"PublisherList",components:{TableSkeleton:c.a},data:()=>({origin:[],shops:[],keyword:"",sid:"",booksList:[],oldRate:[]}),computed:{...Object(a.b)("common",["skeletonLoading","mobile"])},async created(){const t=Object(n.b)("userInfo");this.sid=t.info.sid,await this.load()},methods:{async load(){this.origin=[],this.shops=[];try{this.$store.commit("common/setSkeleton",!0);const t=Object(i.m)(Object(i.b)(e.b,"shopInfo"));(await Object(i.h)(t)).forEach(t=>{this.origin.push({uid:t.id,data:t.data()}),this.shops.push({uid:t.id,data:t.data()})}),this.$store.commit("common/setSkeleton",!1)}catch(t){console.log(t)}},booksRateModal(t){console.log(this.mobile),this.mobile?this.$modal.show(h,{id:t,origin:this.origin,update:this.load},Object(u.a)("ModalBookRate","95%","auto",!1)):this.$modal.show(h,{id:t,origin:this.origin,update:this.load},Object(u.a)("ModalBookRate","800px","auto",!1))},async shopRateSave(){try{this.$store.commit("common/setLoading",!0);const t=Object(i.s)(e.b);this.shops.forEach(s=>{const o=s.data.shopRate.filter(t=>t.sid!==this.sid),a=Object(i.d)(e.b,"shopInfo",s.uid);s.data.shopRate.forEach(e=>{e.sid===this.sid&&t.set(a,{...s.data,shopRate:[...o,{sid:this.sid,rate:e.rate}]})})}),await t.commit(),await this.load(),alert("저장되었습니다."),this.$store.commit("common/setLoading",!1)}catch(t){this.$store.commit("common/setLoading",!1),console.log(t)}},search(){if(""!==this.keyword){const t=this.origin.filter(t=>{if(t.data.shop.includes(this.keyword))return t});this.shops=t}else this.shops=this.origin}}},b=(o("65da"),Object(l.a)(m,(function(){var t=this,s=t._self._c;return s("section",[s("h2",{staticClass:"sub-title"},[t._v("서점별 공급률 설정")]),s("section",{staticClass:"sub-container"},[s("section",{staticClass:"search"},[s("input",{directives:[{name:"model",rawName:"v-model",value:t.keyword,expression:"keyword"}],attrs:{type:"text"},domProps:{value:t.keyword},on:{keypress:function(s){return!s.type.indexOf("key")&&t._k(s.keyCode,"enter",13,s.key,"Enter")?null:t.search.apply(null,arguments)},input:function(s){s.target.composing||(t.keyword=s.target.value)}}}),s("button",{on:{click:t.search}},[t._v("검색")])]),t.skeletonLoading?s("TableSkeleton"):s("table",[s("thead",[s("tr",[s("th",[t._v("서점명")]),s("th",[t._v("이메일")]),s("th",[t._v("서점 공급률")]),s("th")])]),t._l(t.shops,(function(o,a){return s("tbody",{key:a},[s("tr",[s("td",[t._v(t._s(o.data.shop))]),s("td",[t._v(t._s(o.data.email))]),s("td",t._l(o.data.shopRate,(function(o,a){return s("span",{key:a},[o.sid===t.sid?s("span",[s("input",{directives:[{name:"model",rawName:"v-model",value:o.rate,expression:"rate.rate"}],attrs:{type:"number"},domProps:{value:o.rate},on:{input:function(s){s.target.composing||t.$set(o,"rate",s.target.value)}}})]):t._e()])})),0),s("td",[s("button",{staticClass:"each",on:{click:function(s){return t.booksRateModal(o.uid)}}},[t._v("서적별 설정")])])])])})),0===t.shops.length?s("tfoot",[s("tr",[s("td",{attrs:{colspan:"4"}},[t._v("서점 리스트가 없습니다.")])])]):t._e()],2),s("div",{staticClass:"save mt20"},[s("button",{staticClass:"primary",on:{click:function(s){return t.shopRateSave()}}},[t._v("저장")])])],1)])}),[],!1,null,"6c7a0db2",null));s.default=b.exports},7402:function(t,s,o){"use strict";var a=o("132d"),e={methods:{close(){this.$emit("close")}}},i=(o("cc0a"),o("2877")),n=Object(i.a)(e,(function(){var t=this._self._c;return t("div",{staticClass:"modal-wrap"},[t("div",{staticClass:"close",on:{click:this.close}},[t(a.a,[this._v("mdi-window-close")])],1),this._t("head"),t("div",{staticClass:"line"}),t("div",{staticClass:"body"},[this._t("body")],2),this._t("footer")],2)}),[],!1,null,"1c84da6b",null);s.a=n.exports},"78c6":function(t,s,o){"use strict";var a=o("3129"),e={name:"TableSkeleton"},i=o("2877"),n=Object(i.a)(e,(function(){return(0,this._self._c)(a.a,{attrs:{type:"table-thead, table-tbody",types:{"table-tbody":"table-row-divider@3","table-row":"table-cell@3","table-thead":"heading@3"}}})}),[],!1,null,"1c06d3ce",null);s.a=n.exports},cc0a:function(t,s,o){"use strict";o("4809")},f237:function(t,s,o){},f630:function(t,s,o){}}]);