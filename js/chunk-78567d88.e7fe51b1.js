(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-78567d88"],{"13f3":function(t,s,o){"use strict";o("2aeb")},"2aeb":function(t,s,o){},"6f4c":function(t,s,o){"use strict";o.r(s);o("14d9");var e=o("2f62"),a=o("e31c"),i=o("e71f"),n=o("f3e4"),c=o("78c6"),r=o("f7fe"),d=o.n(r),h={name:"PublisherList",components:{TableSkeleton:c.a},data:()=>({origin:[],shops:[],keyword:"",sid:"",booksList:[],oldRate:[]}),computed:{...Object(e.b)("common",["skeletonLoading"])},async created(){const t=Object(n.b)("userInfo");this.sid=t.info.sid,await this.load()},methods:{async load(){this.origin=[],this.shops=[];try{this.$store.commit("common/setSkeleton",!0);const t=Object(i.i)(Object(i.b)(a.b,"shopInfo"));(await Object(i.f)(t)).forEach(t=>{this.origin.push({uid:t.id,data:t.data()}),this.shops.push({uid:t.id,data:t.data()})}),this.$store.commit("common/setSkeleton",!1)}catch(t){console.log(t)}},async shopRateSave(){try{this.$store.commit("common/setLoading",!0);const t=Object(i.n)(a.b);this.shops.forEach(s=>{const o=s.data.shopRate.filter(t=>t.sid!==this.sid),e=Object(i.d)(a.b,"shopInfo",s.uid);s.data.shopRate.forEach(a=>{a.sid===this.sid&&t.set(e,{...s.data,shopRate:[...o,{sid:this.sid,rate:a.rate}]})})}),await t.commit(),await this.load(),alert("저장되었습니다."),this.$store.commit("common/setLoading",!1)}catch(t){this.$store.commit("common/setLoading",!1),console.log(t)}},booksRateSet:d()((async function(t){this.$store.commit("common/setLoading",!0),this.booksList=[];const s=Object(i.i)(Object(i.b)(a.b,"booksData"),Object(i.m)("sid","==",this.sid));(await Object(i.f)(s)).forEach(s=>{this.booksList.push({id:t,data:s.data(),rate:""})});const o=[];this.origin.forEach(s=>{s.uid===t&&s.data.bookRate.forEach(t=>{o.push(t.data)})}),this.booksList.forEach(t=>{o.forEach(s=>{s.isbn===t.data.isbn&&(t.rate=s.rate)})}),this.$store.commit("common/setLoading",!1)}),300),async booksRateSave(t){this.origin.forEach(s=>{s.uid===t&&(this.oldRate=s.data.bookRate)});const s=[];this.booksList.forEach(o=>{s.push({uid:t,data:{isbn:o.data.isbn,rate:o.rate}})});const o=this.oldRate.filter(t=>{s.forEach(s=>{if(t.data.isbn!==s.data.isbn)return t})}),e=s.concat(o);this.$store.commit("common/setLoading",!0);try{await Object(i.l)(Object(i.d)(a.b,"shopInfo",t),{bookRate:e}),await this.load(),this.$store.commit("common/setLoading",!1)}catch(t){console.log(t),this.$store.commit("common/setLoading",!1)}},search(){if(""!==this.keyword){const t=this.origin.filter(t=>{if(t.data.shop.includes(this.keyword))return t});this.shops=t}else this.shops=this.origin}}},l=(o("13f3"),o("2877")),u=Object(l.a)(h,(function(){var t=this,s=t._self._c;return s("section",[s("h2",{staticClass:"sub-title"},[t._v("서점별 공급률 설정")]),s("section",{staticClass:"sub-container"},[s("section",{staticClass:"search"},[s("input",{directives:[{name:"model",rawName:"v-model",value:t.keyword,expression:"keyword"}],attrs:{type:"text"},domProps:{value:t.keyword},on:{keypress:function(s){return!s.type.indexOf("key")&&t._k(s.keyCode,"enter",13,s.key,"Enter")?null:t.search.apply(null,arguments)},input:function(s){s.target.composing||(t.keyword=s.target.value)}}}),s("button",{on:{click:t.search}},[t._v("검색")])]),t.skeletonLoading?s("TableSkeleton"):s("table",[s("thead",[s("tr",[s("th",[t._v("서점명")]),s("th",[t._v("이메일")]),s("th",[t._v("서점 공급률")]),s("th")])]),t._l(t.shops,(function(o,e){return s("tbody",{key:e},[s("tr",[s("td",[t._v(t._s(o.data.shop))]),s("td",[t._v(t._s(o.data.email))]),s("td",t._l(o.data.shopRate,(function(o,e){return s("span",{key:e},[o.sid===t.sid?s("span",[s("input",{directives:[{name:"model",rawName:"v-model",value:o.rate,expression:"rate.rate"}],attrs:{type:"number"},domProps:{value:o.rate},on:{input:function(s){s.target.composing||t.$set(o,"rate",s.target.value)}}})]):t._e()])})),0),s("td",[s("button",{staticClass:"each",on:{click:function(s){return t.booksRateSet(o.uid)}}},[t._v("서적별 설정")])])]),t.booksList.length>0&&o.uid===t.booksList[0].id?s("tr",[s("td",{attrs:{colspan:"4"}},[t._l(t.booksList,(function(o){return s("div",{key:o.data.isbn,staticClass:"d-flex book-list"},[s("span",[t._v(t._s(o.data.subject))]),s("span",[t._v(t._s(o.data.isbn))]),s("span",[s("input",{directives:[{name:"model",rawName:"v-model",value:o.rate,expression:"book.rate"}],attrs:{type:"number"},domProps:{value:o.rate},on:{input:function(s){s.target.composing||t.$set(o,"rate",s.target.value)}}})])])})),s("div",{staticClass:"btn-save"},[s("button",{staticClass:"primary",on:{click:function(s){return t.booksRateSave(o.uid)}}},[t._v("서적별 공급률 저장")])])],2)]):t._e()])})),0===t.shops.length?s("tfoot",[s("tr",[s("td",{attrs:{colspan:"4"}},[t._v("서점 리스트가 없습니다.")])])]):t._e()],2),s("div",{staticClass:"save mt20"},[s("button",{staticClass:"primary",on:{click:function(s){return t.shopRateSave()}}},[t._v("저장")])])],1)])}),[],!1,null,"19096650",null);s.default=u.exports},"78c6":function(t,s,o){"use strict";var e=o("3129"),a={name:"TableSkeleton"},i=o("2877"),n=Object(i.a)(a,(function(){return(0,this._self._c)(e.a,{attrs:{type:"table-thead, table-tbody",types:{"table-tbody":"table-row-divider@3","table-row":"table-cell@3","table-thead":"heading@3"}}})}),[],!1,null,"1c06d3ce",null);s.a=n.exports}}]);